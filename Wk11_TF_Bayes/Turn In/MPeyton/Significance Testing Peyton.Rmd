---
title: "Significance Tests Peyton"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE, echo = FALSE, results = "hide"}
library(palaeoSig)
library(rioja)
library(analogue)
data(SWAP)
data(RLGH)
data(Pollen)
data(Climate)
climate <- Climate
Pollen[is.na(Pollen)] <- 0
pollen <- (Pollen/rowSums(Pollen)) * 100
```


###1. Significance of pH reconstruction

```{r, warning=FALSE}
ph <- SWAP$pH
species <- SWAP$spec
fossil.spec <- RLGH$spec
depth <- RLGH$depths

#WA
ph.wa <- rioja::WA(sqrt(species), ph, lean = FALSE)
ph.wa.cal <- rioja::crossval(ph.wa)
plot(ph.wa.cal)

#MAT
ph.mat <- rioja::MAT(sqrt(species), ph, lean = FALSE, k = 5)
ph.mat.cal <- rioja::crossval(ph.mat)
plot(ph.mat.cal)

#WAPLS
ph.wapls <- rioja::WAPLS(sqrt(species), ph, lean = FALSE)
ph.wapls.cal <- rioja::crossval(ph.wapls)
plot(ph.wapls.cal) #Use two components

#Reconstruct with WA
ph.wa.pred <- predict(ph.wa.cal, sqrt(fossil.spec))

#Reconstruct with MAT
ph.mat.pred <- predict(ph.mat.cal, sqrt(fossil.spec))
ph.mat.pred

#Reconstruct with WAPLS
ph.wapls.pred <- predict(ph.wapls.cal, sqrt(fossil.spec))

layout(matrix(c(1,2,3,1,2,3), byrow = TRUE, ncol = 3))
plot(depth[,2] ~ ph.mat.pred$fit[,2], type = "l", ylim = c(20,0), main = "MAT", ylab = "Depth", xlab = "pH", xlim = c(4.7,5.25))
plot(depth[,2] ~ ph.wa.pred$fit[,2], type = "l", ylim = c(20,0), main = "WA", ylab = "Depth", xlab = "pH", xlim = c(4.7,5.25))
plot(depth[,2] ~ ph.wapls.pred$fit[,2], type = "l", ylim = c(20,0), main = "WAPLS", ylab = "Depth", xlab = "pH", xlim = c(4.7,5.25))
```


```{r, warning=FALSE}
test.wa <- palaeoSig::randomTF(sqrt(species), ph, sqrt(fossil.spec), n = 999, fun = WA) #Testing WA
test.mat <- palaeoSig::randomTF(spp = sqrt(SWAP$spec), env = data.frame(pH = SWAP$pH), 
    fos = sqrt(RLGH$spec), n = 999, fun = MAT, col = 1) #Testing MAT
test.wapls <- palaeoSig::randomTF(sqrt(species), env = ph, sqrt(fossil.spec), n = 999, fun = WAPLS, col = 2) #Testing WAPLS

layout(matrix(c(1,2,3,1,2,3), byrow = TRUE, ncol = 3))
plot(test.wa)
plot(test.mat)
plot(test.wapls)
```

The WA and WAPLS reconstructions explain more variance than the 5% of the reconstructions from random environmental variables that explained the most variance, while the MAT reconstruction explains less variance than the top 5% of random variable reconstructions. Therefore the WA and WAPLS models appear to be capturing a real variable that the fossil set is responding to sufficiently to be used in our reconstruction.

**Now let's test using obs.cor**

```{r}
wa.cor <- palaeoSig::obs.cor(sqrt(species), ph, sqrt(fossil.spec), ord = rda, n = 999)
layout(matrix(c(1,2,1,2), byrow = TRUE, ncol = 2))
plot(wa.cor)
plot(wa.cor, which = 2)
```

There appears to be a sufficient correlation between species optima and the species scores of the fossil set along the first RDA axis. This correlation also is higher than 5% of the random weighted correlations this model was tested against.


###2. Significance of pollen based reconstructions

**Test the significance of all reconstructions using randomTF**

(Using the same objects as in last week's assignment)

```{r}
pollen <- (pollen/rowSums(pollen))*100
tjan <- data.frame(climate$tjan)
tjul <- data.frame(climate$tjul)
#MAT
jan.mat.test <- palaeoSig::randomTF(sqrt(pollen), tjan, sqrt(fossil.per), n=999, fun = MAT, ord = rda)
jul.mat.test <- palaeoSig::randomTF(sqrt(pollen), tjul, sqrt(fossil.per), n=999, fun = MAT, ord = rda)

#WA
jan.wa.test <- palaeoSig::randomTF(sqrt(pollen), tjan, sqrt(fossil.per), n=999, fun = WA, ord = rda)
jul.wa.test <- palaeoSig::randomTF(sqrt(pollen), tjul, sqrt(fossil.per), n=999, fun = WA, ord = rda)

#WAPLS
jan.wapls.test <- palaeoSig::randomTF(sqrt(pollen), tjan, sqrt(fossil.per), n=999, fun = WA, ord = rda, col = 2)
jul.wapls.test <- palaeoSig::randomTF(sqrt(pollen), tjul, sqrt(fossil.per), n=999, fun = WA, ord = rda, col = 2)

#Plot MAT
layout(matrix(c(1,2,1,2), byrow = TRUE, ncol = 2))
plot(jan.mat.test)
plot(jul.mat.test)

#Plot WA
layout(matrix(c(1,2,1,2), byrow = TRUE, ncol = 2))
plot(jan.wa.test)
plot(jul.wa.test)

#Plot WAPLS
layout(matrix(c(1,2,1,2), byrow = TRUE, ncol = 2))
plot(jan.wapls.test)
plot(jul.wapls.test)
```

According to this test of random environmental variable reconstructions, the only reconstruction which explains more variance than 95% of random reconstructions is the MAT for January temperature. However, all reconstructions typically explained far less variance than the first rda axis.

**Assess significance using obs.cor**

```{r}
tjan <- as.vector(tjan)
tjul <- as.vector(tjul)
#WA
jan.wa.cor <- palaeoSig::obs.cor(sqrt(pollen), tjan$climate.tjan, sqrt(fossil.per), ord = rda, n = 999)
jul.wa.cor <- palaeoSig::obs.cor(sqrt(pollen), tjul$climate.tjul, sqrt(fossil.per), ord = rda, n = 999)
#Jan
layout(matrix(c(1,2,1,2), byrow = TRUE, ncol = 2))
plot(jan.wa.cor)
plot(jan.wa.cor, which = 2)
#July
layout(matrix(c(1,2,1,2), byrow = TRUE, ncol = 2))
plot(jul.wa.cor)
plot(jul.wa.cor, which = 2)
```

###Puppy Book Exercises

(2.1)
**Model A**: P(x) = 1/4 (all four sides are equally likely)

1 = 2 = 3 = 4 = 1/4

**Model B**: P(x) = x/10 (larger value faces are more likely)

1 = 1/10 | 2 = 1/5 | 3 = 3/10 | 4 = 2/5

**Model C**: P(x) = 12/(25x) (smaller value faces are more likely)

1 = 12/25 | 2 = 12/50 | 3 = 12/75 | 4 = 12/100

(2.2)
If we roll the die 100 times and get 1 = 2 = 3 = 4 = 25 times, our belief about the models change to assume the likelihood of model A to be higher.

If we roll the die 100 times and get 1 = 48, 2 = 24, 3 = 16, 4 = 12, now the likelihood that model C is correct increases.

