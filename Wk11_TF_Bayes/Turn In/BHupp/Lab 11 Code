WEEK 11: Significance Tests and Bayes
Brittany Hupp


QUESTION 1
#Load all appropriate packages and datasets
library(vegan)
library(palaeoSig)
library(rioja)
library(analogue)

data(SWAP)
data(RLGH)

#Test MAT using randomTF
rlgh.MAT.test <- randomTF(spp = SWAP$spec, env = data.frame(pH = SWAP$pH),
    fos = sqrt(RLGH$spec), n = 999, fun = MAT, col = 1)
rlgh.MAT.test$sig
#pH significance=0.02
plot.palaeoSig(rlgh.MAT.test, "pH")

#Test WA using randomTF
rlgh.WA.test <- randomTF(spp = SWAP$spec, env = data.frame(pH = SWAP$pH),
    fos = sqrt(RLGH$spec), n = 999, fun = WA, col = 1)
rlgh.WA.test$sig
#pH significance=0.02
plot.palaeoSig(rlgh.WA.test, "pH")

#Test WAPLS using randomTF
rlgh.WAPLS.test <- randomTF(spp = SWAP$spec, env = data.frame(pH = SWAP$pH),
    fos = sqrt(RLGH$spec), n = 999, fun = WAPLS, col = 1, dist.method="sq.euclidean")
rlgh.WAPLS.test$sig
#pH significance=0.02
plot.palaeoSig(rlgh.WAPLS.test, "pH")

#Test WA using obs.cor
rlgh.obs.WA <- obs.cor(spp = SWAP$spec, env = SWAP$pH, fos = RLGH$spec, n= 999)
rlgh.obs.WA$sig
#abun.fos abun.calib abun.joint     n2.fos   n2.calib   n2.joint
#      0.04       0.05       0.06       0.01       0.01       0.01
#unweighted
#      0.01
plot(rlgh.obs.WA, which=1)
plot(rlgh.obs.WA, which=2)

#Can this function be used to test WAPLS reconstructions?


QUESTION 2:

#Load relevant Packages
library(rioja)
library(analogue)
library(vegan)
library(neotoma)
library(palaeoSig)

#Dowload climate and pollen from North American Pollen Database (NAMPD)
data(Climate)
data(Pollen)

## MAT MODELING
#Correcting climate column names
colnames(Climate)[1:3] <- c('tjan','tfeb','tmar')

#Acquire Mendota D core pollen dataset from neotoma and change to percentages
mendotaD <- get_dataset(1679)
mendotaD.data <- get_download(mendotaD)
mendota.pol <- mendotaD.data[[1]]

#Need to replace NA's within modern pollen dataset to zeros
modern.pol.corrected <- replace(Pollen,is.na(Pollen),0)

#Need to convert the modern pollen to proportions as well as the mendota Pollen
modern.pol.pct <- analogue::tran(x = modern.pol.corrected, method = 'percent')
mendota.pol.pct <- analogue::tran(x =  mendota.pol$counts, method = 'percent')

#Now to convert the names of the Mendota D dataset to be the same as what is used in the NAMPD
mendota.pol.compile <- compile_taxa(mendota.pol.pct, list = "WhitmoreFull")

#Now to compare the two Mendota D and modern NAMPD datasets and remove taxa that are not found in both
# This removes the 'other' column which is in the 16th position
fossil.pol <- mendota.pol.compile[, -16]
modern.pol <- modern.pol.pct[,which(colnames(modern.pol.pct) %in% colnames(fossil.pol))]

#Data is now prepped to create modern analogue models (MAT)
#Environmental variables of interest: July temp and January temp
tjan <- Climate$tjan
tjul <- Climate$tjul

#Test MAT using randomTF for January Temperature on Mendota D data
mendota.MAT.test.jan <- randomTF(spp = modern.pol, env = data.frame(tjan),
    fos = fossil.pol, n = 999, fun = MAT, col = 1)
mendota.MAT.test.jan$sig
tjan=0.048
plot.palaeoSig(mendota.MAT.test.jan, "tjan")

#Test MAT using randomTF for July Temperature on Mendota D data
mendota.MAT.test.jul <- randomTF(spp = modern.pol, env = data.frame(tjul),
    fos = fossil.pol, n = 999, fun = MAT, col = 1)
mendota.MAT.test.jul$sig
tjul=0.062
plot.palaeoSig(mendota.MAT.test.jul, "tjul")

#Test WA using randomTF for January Temperature on Mendota D data
mendota.WA.test.jan <- randomTF(spp = modern.pol, env = data.frame(tjan),
    fos = fossil.pol, n = 999, fun = WA, col = 1)
mendota.WA.test.jan$sig
tjan=0.287
plot.palaeoSig(mendota.WA.test.jan, "tjan")

#Test WA using randomTF for July Temperature on Mendota D data
mendota.WA.test.jul <- randomTF(spp = modern.pol, env = data.frame(tjul),
    fos = fossil.pol, n = 999, fun = WA, col = 1)
mendota.WA.test.jul$sig
tjul=0.278
plot.palaeoSig(mendota.WA.test.jul, "tjul")

#Test WAPLS using randomTF for January Temperature on Mendota D data
mendota.WAPLS.test.jan <- randomTF(spp = modern.pol, env = data.frame(tjan),
    fos = fossil.pol, n = 999, fun = WAPLS, col = 1)
mendota.WAPLS.test.jan$sig
tjan=0.293
plot.palaeoSig(mendota.WAPLS.test.jan, "tjan")

#Test WAPLS using randomTF for July Temperature on Mendota D data
mendota.WAPLS.test.jul <- randomTF(spp = modern.pol, env = data.frame(tjul),
    fos = fossil.pol, n = 999, fun = WAPLS, col = 1)
mendota.WAPLS.test.jul$sig
tjul=0.261
plot.palaeoSig(mendota.WAPLS.test.jul, "tjul")

#Test WA using obs.cor
mendota.obs.WA <- obs.cor(spp = modern.pol, env = tjul, fos = fossil.pol, n= 999)
mendota.obs.WA$sig
plot(mendota.obs.WA, which=1)
plot(mendota.obs.WA, which=2)
^There was an error that was making these datasets incompatible for this function.

fos.pol.vp <- varpart(fossil.pol, Climate$tave, Climate$annp)
^Varpart will not work either because of differences in row number. . .


QUESTION 3:
1. Event A: Someone has the disease. (1/1,000,000)
Event B: Someone correctly tests positive for that disease. (67/100)

2.  P(A)=(1/1,000,0000)
    P(B|A)=0.67
    P(Ac)= 1-(1/1,000,000)
    P(B|Ac)=0.33
    P(A|B)=?

    P(A|B)=(P(B|A)*(P(A)))/((P(B|A)*P(A))+(P(B|Ac)*P(Ac)))
    P(A|B)=(0.67*(10^-6))/((0.67*(10^-6)+(0.33*0.999)))
    P(A|B)=2.03*10^-6
