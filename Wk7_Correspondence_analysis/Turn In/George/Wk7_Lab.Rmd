---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 


*Question 2*
```{r}
install.packages("palaeoSig", repos='http://cran.us.r-project.org')
install.packages("vegan", repos='http://cran.us.r-project.org')
library(palaeoSig)
library(vegan)

View(arctic.pollen)

# Gets list of available datasets from Jemima Lake in MA 
arctic_pollen_data <- arctic.pollen

# Selects only taxa with a mean of at least two
#inclusion.criterion <- apply(percentages,2,function(x) (mean(x))>2)
#percentages_clean <- percentages[,inclusion.criterion]

# Square root transform data
arctic_pollen_sq <- sqrt(arctic_pollen_data)

# Runs pca on dataset with rda
arctic_cca <- vegan::cca(arctic_pollen_sq) 

# Looks at variance explained
arctic_cca_sum <- summary(arctic_cca)
arctic_cca_sum

# Makes screeplot
screeplot(arctic_cca, bstick = TRUE)

# Makes ordination biplot
plot(arctic_cca, scaling=1,display='sites',xlim=c(-1,1),ylim=c(-1,1))
points(arctic_cca,display='sites',scaling=1)
points(arctic_cca,display='species',scaling=0,pch = 15,col=4)
text(arctic_cca,display='species',scaling=0,pos=1)
vegan::ordisurf(x = arctic_cca, arctic.env$tjul)

# Plot CA2 and CA3
plot(arctic_cca,choices = c(2,3),scaling=1,display='sites',xlim=c(-1,1),ylim=c(-1,1))
points(arctic_cca,display='sites',scaling=1)
points(arctic_cca,display='species',scaling=0,pch = 15,col=4)
text(arctic_cca,display='species',scaling=0,pos=1)
vegan::ordisurf(x = arctic_cca, arctic.env$tjul, choices = c(2,3))

```
1) CA1 explains 22.06% of the variance and CA2 explains 13.55% of the variance. All others are insignificant based on the broken stick model. 

2) The data points form an arch indicating that we can only interpret axis 1. 
There are several groups of 2-3 species clustered together: in the bottom right, upper right, and the far left. 

*Question 4*

```{r}
install.packages("TeachingDemos", repos='http://cran.us.r-project.org')
library(TeachingDemos)

norway_data <- readRDS("~/github/Geography523/Wk7_Correspondence_analysis/Data/RDA_Data.RDS")
norway_pollen <- norway_data[1:25]
norway_pollen_sq <- sqrt(norway_pollen)
norway_rda_ctemp <- vegan::rda(norway_pollen_sq, norway_data$temp.rec)
norway_rda_cprecip <- vegan::rda(norway_pollen_sq, norway_data$precip.rec)
norway_rda_call <- vegan::rda(norway_pollen_sq, norway_data$temp.rec, norway_data$precip.rec)

# Looks at variance explained for temp constrained, precip constrained, and both constrained rda
norway_rda_ctemp_sum <- summary(norway_rda_ctemp)
norway_rda_ctemp_sum

norway_rda_cprecip_sum <- summary(norway_rda_cprecip)
norway_rda_cprecip_sum

norway_rda_call_sum <- summary(norway_rda_call)
norway_rda_call_sum

# fits environmental vector onto the rda
fit <- envfit(norway_rda_call, norway_data$temp.rec)
fit.2 <- envfit(norway_rda_call, norway_data$precip.rec)

#creates triplot
plot(norway_rda_call)
segments(x0=0,y0=0, x1=scores(norway_rda_call, display="species", scaling=2)[,1], y1=scores(norway_rda_call, display="species", scaling=2)[,2])
plot(fit, col = "black", add = TRUE, labels = "Temperature")
plot(fit.2, col = "black", add = TRUE, labels = "Precipitation")

#creates triplot with precipitation ordination surface
plot(norway_rda_call)
vegan::ordisurf(x = norway_rda_call, norway_data$precip.rec)
segments(x0=0,y0=0, x1=scores(norway_rda_call, display="species", scaling=2)[,1], y1=scores(norway_rda_call, display="species", scaling=2)[,2])
plot(fit, col = "black", add = TRUE, labels = "Temperature")
plot(fit.2, col = "black", add = TRUE, labels = "Precipitation")

#creates triplot with temperature ordination surface
plot(norway_rda_call)
vegan::ordisurf(x = norway_rda_call, norway_data$temp.rec)
segments(x0=0,y0=0, x1=scores(norway_rda_call, display="species", scaling=2)[,1], y1=scores(norway_rda_call, display="species", scaling=2)[,2])
plot(fit, col = "black", add = TRUE, labels = "Temperature")
plot(fit.2, col = "black", add = TRUE, labels = "Precipitation")
```

Picea and Pinus percentages are different from most other species, because they're so far away. Temperature and precipitation are both drivers in species percentages in a population. 