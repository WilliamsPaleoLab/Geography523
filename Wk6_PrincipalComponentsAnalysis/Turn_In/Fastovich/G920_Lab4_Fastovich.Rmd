---
title: "G920_Lab4_Fastovich"
author: "David Fastovich"
date: "October 19, 2018"
output: 
  html_document:
    theme: spacelab
    highlight: pygments
---

### Starting off by loading the necessary libraries for the homework.
```{r message=FALSE}
library(vegan)
library(palaeoSig)
library(neotoma)
```

### Loading in all of the required data for the principal components analysis.
```{r}
data("arctic.env")
env.sub <- data.frame(temp.max = arctic.env$tmax,
                      temp.min = arctic.env$tmin,
                      tave = arctic.env$tave,
                      pjan = arctic.env$pjan,
                      pjul = arctic.env$pjul,
                      ptotal = arctic.env$ptotal)
```

### With the data prepared its time to start looking at different methods of performing principal components analysis.
```{r}
rda.env.cov <- rda(env.sub)
rda.env.cor <- rda(env.sub, scale = TRUE)
# summary(rda.env.cov) # This is prevented from running because the output takes up a bulk of the page
# summary(rda.env.cor) # This is prevented from running because the output takes up a bulk of the page
par(mfrow = c(1,2))
screeplot(rda.env.cov, bstick = TRUE)
screeplot(rda.env.cor, bstick = TRUE)
```
The `rda` funciton in `vegan` uses the covariance matrix by default. By setting the `scale = TRUE` we use the correlation coefficients of the variables instead of the covariance matrix which can provide a more balanced ordination. 99% of the variance in the data is explained in the first PC axis when using the covariance matrix. Scaling the data (using the correlation coefficients) the varaince explained drops to 64% for PC1 and its not until PC5 do we see 99% of the variance explained. This occurs because when using the covariance matrix the *ptotal* value controls most of the variance as it is an order of magnitude larger than the rest of the environmental variables. Scaling the data prevents this from occuring, therefore less variance is explained.

### Now using the `princomp` function within the defautl `stats` package.
```{r}
pca.env.cov <- princomp(env.sub) # Covariance matrix
pca.env.cor <- princomp(env.sub, cor = TRUE) # Correlation matrix
summary(pca.env.cov)
summary(pca.env.cor)
par(mfrow = c(1,2))
screeplot(pca.env.cov, bstick = TRUE)
screeplot(pca.env.cor, bstick = TRUE)
```
While the absolute values are different the variance explained is identical to using the `rda` function. When using the covariance matrix 99% of the variance explained by PC1 and changing to the correlation matrix reduces this to just 64%. Again, this occurs because of the large *ptotal* value which has the largest variance and therefore minimizes the variance contributed by the remaining environmental variables.

### Making and interpretting biplots for the standardized variables/correlation matrix.
```{r}
par(mfrow = c(1,2))
biplot(pca.env.cor, pc.biplot = TRUE)
plot(rda.env.cor, scaling = 1, xlim = c(-1, 1), ylim = c(-1, 1), display = "sites", type = "n")
points(rda.env.cor, display = "sites", scaling = 1, col = (arctic.env$BIOME))
points(rda.env.cor, display = "species", scaling = 0, pch = 15, col = 4)
text(rda.env.cor, display = "species", scaling = 0, pos = 1)
```
The biplot produced by `rda` indicates that *ptotal*, *pjune*, and *tave* are the primary contributors to PC1. Interestingly, each of the sites in the three biomes spans a variety of different average temperatures and average annual precipitation values. There are several sites, particularly in the arctic that have particularly extreme values of precipitation making them different from the remaining sites. PC2 explains variance primary in the maximum and minimum temperatures in the sites and very clearly discriminates between the three biomes. Each biome is very tightly constrained within a small range on PC2.

### PCA on Lake Tulane pollen data
```{r warning=FALSE, message=FALSE}
# Getting the data and cleaning it first
tul.site <- get_site("*tulane*")
tul.dataset <- get_dataset(tul.site, datasettype = "pollen", ageold = 9000, ageyoung = 0)
tul.down <- get_download(tul.dataset, verbose = FALSE)
tul.poll <- tul.down$`19620`$counts
tul.perc <- (tul.poll/rowSums(tul.poll))*100
tul.perc <- tul.perc[, colMeans(tul.perc) > 2]

# Now moving onto PCA
tul.fin <- sqrt(tul.perc)
tul.rda <- rda(tul.fin)
layout(matrix(data = c(1, 3, 2, 3), ncol = 2))
screeplot(tul.rda, bstick = TRUE)
tul.scores <- scores(tul.rda)
plot(tul.scores$species[,1], xaxt = "n")
axis(1, at=1:7, labels = colnames(tul.perc))
plot(tul.rda, xlim = c(-1, 1), ylim = c(-1, 1), scaling = 1, display = "sites")
points(tul.rda, display = "species", scaling = 0, pch = 15, col = 4)
text(tul.rda, display = "species", scaling = 0, pos = 1)
```

* Looks like there is only 1 significant axis and it is PC1.
* The biplot shows that species which increase together in the pollen diagram are found together in PC-space. For instance, *Quercus* increases regularly throughout the pollen record and when it does so too does Poaceae and other herbs/forbs.