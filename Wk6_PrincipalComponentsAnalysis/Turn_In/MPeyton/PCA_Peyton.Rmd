---
title: "PCA"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo = FALSE}
library(vegan)
library(palaeoSig)
library(stats)
```
```{r}
arctic <- data(arctic.env) #Load arctic.env
```


Let's create a subset of the data containing: Maximum monthly temperature, minimum monthly temperature, annual mean temperature, July precipitation, January precipitation, and the sum of annual precipitation.

```{r}
arctic <- cbind(arctic.env$tmin, arctic.env$tmax, arctic.env$tave, arctic.env$pjul, arctic.env$pjan, arctic.env$ptotal)
c.names <- c("tmin", "tmax", "tave", "pjul", "pjan", "ptotal")
colnames(arctic) <- c.names #Assign colum names
```


####RUN PCA USING RDA AND PRINCOMP

```{r}
arctic.pca <- rda(arctic, scale = TRUE) #Set up PCA using rda
plot(arctic.pca, scaling = 2, display = "sites", xlim = c(-1,1), ylim = c(-1,1)) #Plot the PCA
points(arctic.pca, display = "sites", scaling = 2)
points(arctic.pca, display = "species", scaling = 0, pch = 15, col = 4)
text(arctic.pca, display = "species", scaling = 0, pos = 1)
screeplot(arctic.pca, bstick = TRUE) #Screeplot

arctic.s <- rda(arctic, scale = TRUE, regularization = "S") #Using covariance
arctic.r <- rda(arctic, scale = TRUE, regularization = "R") #Using correlation
plot(arctic.r, scaling = 2, display = "sites", xlim = c(-1,1), ylim = c(-1,1))  #Using correlation matrix
arctic.prin <- princomp(arctic) #Set up PCA using princomp
biplot(arctic.prin) #Plot PCA
screeplot(arctic.prin, bstick = TRUE) #Screeplot
```


Interpretation of the PCA generated using rda: PC1 explains 0.6416 of the variance and PC2 explains 0.2509. Total, January and July precipitation appears to be fairly well correlated with PC1, and average temperature also appears moderately correlated with PC1 as well. Maximum and minimum temperatures appear to drive most of the variation seen in PC2. By this visualization we can infer that most of the variation is driven by total precipitation, but minimum and maximum temperatures also play a large role (particularly maximum temperatures).

####Color code the sites in the biplot

```{r}
biomes <- arctic.env$BIOME
colors <- c("gray", "green", "blue")
shapes <- c(17,19,15)
plot(arctic.pca, scaling = 2, display = "sites", xlim = c(-1,1), ylim = c(-1,1)) #Plot PCS
points(arctic.pca, display = "sites", pch = shapes[biomes], col = colors[biomes], scaling = 2.5) #Sites organized by biome
legend("bottomright", c("Arctic","Boreal","Subarctic"), col = c("gray", "green", "blue"), pch = c(17,19,15)) #Add legend
```


It appears maximum temperature (and minimum temperature to a lesser extent) most strongly correlates to PC2, which is the more important axes in explaining the distribution of biomes.


##PCA on Maui pollen dataset

Dataset was taken and cleaned from previous Rioja exercise. Data are presented in pollen percents, taxa >2% only and constrained to 9000 cal BP. Assigned to object "pollen". Depth taken and assigned to object "depth".

```{r,echo=FALSE}
pollen <- read.csv("C:/Users/micha/OneDrive/Documents/Grad School/Grad School Year 2/Quantitative Methods in Paleoecology/Paleo-R/PaleoPractice/pollen_clean.csv")
depth <- read.csv("C:/Users/micha/OneDrive/Documents/Grad School/Grad School Year 2/Quantitative Methods in Paleoecology/Paleo-R/PaleoPractice/depth.csv")
depth <- depth[,2]
```
```{r}
pollen.trans <- sqrt(pollen) #Sqrt transform the data
rownames(pollen.trans) <- depth
pollen.pca <- rda(pollen.trans, scale = TRUE)
plot(pollen.pca, scaling = 2, display = "sites", xlim = c(-1,1), ylim = c(-2,4))
screeplot(pollen.pcs, bstick = TRUE)
```


According to the broken stick method, there appear to be at least nine significant axes in this PCA. PC1 explains .1541 of the variance and PC2 explains 0.1121. Samples appear to segregate along the first axis based on depth with new samples toward the middle, moderately old samples on the positive end, and older samples exhibiting negative PC1 scores.